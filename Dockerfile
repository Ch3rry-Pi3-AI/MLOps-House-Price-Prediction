# -------------------------------------------------------------------
# ‚úÖ Base image (Python 3.13 slim)
# -------------------------------------------------------------------
FROM python:3.13-slim

# -------------------------------------------------------------------
# üß© Environment settings
# -------------------------------------------------------------------
ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1

# -------------------------------------------------------------------
# üìÇ Working directory
# -------------------------------------------------------------------
WORKDIR /app

# -------------------------------------------------------------------
# üì¶ Install dependencies (copied first for Docker layer caching)
# -------------------------------------------------------------------
COPY src/api/requirements.txt ./requirements.txt
RUN pip install --no-cache-dir -r requirements.txt

# -------------------------------------------------------------------
# üß† Copy API source code (as a proper Python package)
# -------------------------------------------------------------------
COPY src/api /app/api
RUN [ -f /app/api/__init__.py ] || touch /app/api/__init__.py

# -------------------------------------------------------------------
# üíæ Copy trained model artefacts
# -------------------------------------------------------------------
RUN mkdir -p /app/models/trained
COPY models/trained/ /app/models/trained/

# -------------------------------------------------------------------
# üåê Expose FastAPI port
# -------------------------------------------------------------------
EXPOSE 8000

# -------------------------------------------------------------------
# üöÄ Launch FastAPI app
# -------------------------------------------------------------------
CMD ["uvicorn", "api.main:app", "--host", "0.0.0.0", "--port", "8000"]